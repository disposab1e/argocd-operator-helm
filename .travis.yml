dist: bionic
language: python
os: linux

python:
- "3.6"

if: branch = travis-ci

jobs:
  include:
    - stage: build-push
      name: operator-bundle
      before_install:
      - build/ci/install-deps-common
      script:
      - build/ci/build-push-ci

    - stage: k8s-test
      name: k8s-1.14.0-minikube
      env: 
        - KUBE_VERSION=v1.14.0
      before_install:
      - build/ci/install-deps-k8s
      install:
      - build/ci/start-minikube
      before_script:
      - build/ci/install-olm
      script:
      - build/ci/generate-k8s-ci
      - build/ci/test-ci
      - build/ci/install-argocd
      after_script:
      - build/ci/stop-minikube
    - name: k8s-1.18.0-minikube    
      env: 
        - KUBE_VERSION=v1.18.0
      before_install:
      - build/ci/install-deps-k8s
      install:
      - build/ci/start-minikube
      before_script:
      - build/ci/install-olm
      script:
      - build/ci/generate-k8s-ci
      - build/ci/test-ci
      - build/ci/install-argocd
      after_script:
      - build/ci/stop-minikube

#    - name: ocp3-3.11.0-minishift   
#      before_install:
#      - build/ci/install-deps-common
#      - build/ci/install-deps-ocp3
#      install:
#      - build/ci/start-minishift
#      script:
#      - build/ci/install-olm-manual
#      - build/ci/install-olm-manual-check
#      - build/ci/build-ocp3-ci
#      - build/ci/test-ocp3-ci
#      - build/ci/install-argocd-ocp3
#      after_script:
#      - build/ci/stop-minishift
