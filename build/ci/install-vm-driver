#!/usr/bin/env bash

set -e

sudo ls -la /root/

sudo apt-get update && sudo apt-get install -y bridge-utils dnsmasq-base ebtables libvirt-bin libvirt-dev qemu-kvm qemu-utils ruby-dev 

# ls -la /var/run/libvirt/libvirt-sock
#sudo usermod -a -G libvirt $USER
#newgrp libvirt
sudo curl -L https://github.com/dhiltgen/docker-machine-kvm/releases/download/v0.10.0/docker-machine-driver-kvm-ubuntu16.04 -o /usr/local/bin/docker-machine-driver-kvm
sudo chmod +x /usr/local/bin/docker-machine-driver-kvm

sudo systemctl stop libvirtd
sudo systemctl start libvirtd
sudo systemctl status libvirtd

sudo virsh net-list --all

#sudo virsh net-start default
#sudo virsh net-autostart default


echo "Installing CRC"
curl -Lo minishift.tgz https://github.com/minishift/minishift/releases/download/v1.34.2/minishift-1.34.2-linux-amd64.tgz
tar xvf minishift.tgz
sudo mv minishift-1.34.2-linux-amd64/minishift /usr/local/bin
chmod +x /usr/local/bin/minishift

export MINISHIFT_ENABLE_EXPERIMENTAL=y

minishift profile set argocd
minishift config set memory 6GB

minishift config view

minishift addon enable admin-user 
minishift addon enable anyuid

minishift addons list

minishift start -v 5