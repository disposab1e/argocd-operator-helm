#!/usr/bin/env bash

set -e

sudo apt-get update && sudo apt-get install -y bridge-utils dnsmasq-base ebtables libvirt-bin libvirt-dev qemu-kvm qemu-utils ruby-dev network-manager

# ls -la /var/run/libvirt/libvirt-sock

sudo systemctl stop libvirtd
sudo systemctl start libvirtd
sudo systemctl status libvirtd

sudo systemctl enable NetworkManager
sudo systemctl start NetworkManager
sudo systemctl status NetworkManager


# Operator SDK
echo "Installing CRC"
curl -Lo crc.tar.xz https://mirror.openshift.com/pub/openshift-v4/clients/crc/latest/crc-linux-amd64.tar.xz
tar xvf crc.tar.xz
mv crc-linux-1.8.0-amd64 crc
cd crc/
ls -la
chmod +x crc
./crc version

./crc config set pull-secret-file ../pull-secret
./crc config set skip-check-root-user true

sudo ./crc setup --log-level debug
sudo ./crc start
