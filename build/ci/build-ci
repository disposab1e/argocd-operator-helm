#!/usr/bin/env bash

# Stop immediately when an error occurs
set -e

# Works in local, github, travisci and circleci environments :-)
cd build/

# Build operator with operator-sdk
make operator-build-ci

# Generate bundle 
make bundle-generate-k8s-ci

# Verify bundle 
make bundle-verify-k8s-ci

# Build bundle (registry) docker image 
make bundle-build-k8s-ci

# Securely login to docker.io
echo "$DOCKER_TOKEN" | docker login -u "$DOCKER_USER" --password-stdin

# Push the operator to dockerhub
make operator-push-ci

# Push the bundle to dockerhub
make bundle-push-k8s-ci

# Generate yaml's for manual operator installation
make guide-generate-k8s-manual-ci

# Generate yaml's for operator installation with olm
make guide-generate-k8s-olm-ci

# Go back ;-)
cd ../

